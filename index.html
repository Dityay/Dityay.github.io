<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ditya - Android Developer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Lexend:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        @font-face {
            font-family: 'ProphecyType';
            src: url('./assets/fonts/PROPHECYTYPE.ttf') format('truetype');
            font-display: swap;
        }

        body, html {
            margin: 0; padding: 0;
            background-color: #000;
            color: white;
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
        }

        /* SPLASH SCREEN */
        #prophecy-splash {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: black;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.5s ease, visibility 1.5s;
        }

        #prophecy-splash.fade-out {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        #sineWrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            will-change: transform;
        }

        #textContainer {
            font-family: 'ProphecyType', serif;
            font-size: clamp(20px, 5vw, 32px);
            text-align: center;
            line-height: 1.2;
            margin-bottom: 20px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            background-size: 256px 256px;
            animation: scrollBg 30s linear infinite;
        }

        @keyframes scrollBg {
            0% { background-position: 0 0; }
            100% { background-position: 512px 512px; }
        }

        #output {
            position: relative;
            width: 512px;
            height: 256px;
            max-width: 95vw;
        }

        canvas {
            position: absolute;
            width: 100%; height: 100%;
            top: 0; left: 0;
            image-rendering: pixelated;
        }

        #bgCanvas { opacity: 0.3; z-index: 1; filter: blur(2px); }
        #ghost2 { opacity: 0.15; z-index: 2; }
        #ghost1 { opacity: 0.3; z-index: 3; }
        #mainPanel { z-index: 4; }

        /* HERO CONTENT */
        .main-header { position: fixed; top:0; width:100%; z-index:100; background: rgba(0,0,0,0.8); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; height: 70px; }
        .logo a { font-family: 'Lexend', sans-serif; font-size: 24px; font-weight: 700; color: #fff; text-decoration: none; }
        nav ul { display: flex; list-style: none; gap: 20px; padding: 0; }
        nav a { color: #ccc; text-decoration: none; }

        #hero { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        h1 { font-family: 'Lexend', sans-serif; font-size: clamp(2.5rem, 8vw, 4rem); margin: 0; }
        .m3-button { padding: 12px 24px; border-radius: 100px; text-decoration: none; font-weight: 500; display: inline-block; margin: 10px; }
        .filled { background: #d0bcff; color: #381e72; }
        .tonal { background: #4a4458; color: #e8def8; }
    </style>
</head>
<body>

    <div id="prophecy-splash">
        <div id="sineWrapper">
            <div id="textContainer"></div>
            <div id="output">
                <canvas id="bgCanvas" width="512" height="256"></canvas>
                <canvas id="ghost2" width="512" height="256"></canvas>
                <canvas id="ghost1" width="512" height="256"></canvas>
                <canvas id="mainPanel" width="512" height="256"></canvas>
            </div>
        </div>
    </div>

    <header class="main-header">
        <div class="nav-container container">
            <div class="logo"><a href="#">Ditya</a></div>
            <nav><ul><li><a href="#">Home</a></li><li><a href="#">About</a></li><li><a href="#">Devices</a></li></ul></nav>
        </div>
    </header>

    <main><section id="hero"><div class="container"><h1>Hello, I'm Ditya</h1><p>Android Developer & Custom ROM Enthusiast</p><a href="#" class="filled m3-button">View Devices</a><a href="#" class="tonal m3-button">GitHub</a></div></section></main>

    <script>
        const presets = {
            'initial-1': { text: 'The prophecy, which whispers \n among the shadows.', y: 20 },
            'heroes-1': { text: 'But lo, on hopes and dreams they send. \n Three heroes at the world\'s end.', y: 10 },
            'main-1': { text: 'A world basked in purest light. \n Beneath it grew eternal night.', y: 15 }
        };

        let maskImg = new Image(), blueTex = new Image(), textTex = new Image(), bgTex = new Image();
        let scrollPos = 0, isActive = true, currentPreset = {};

        const mainCanvas = document.getElementById('mainPanel'), mctx = mainCanvas.getContext('2d');
        const g1ctx = document.getElementById('ghost1').getContext('2d'), g2ctx = document.getElementById('ghost2').getContext('2d');
        const bgctx = document.getElementById('bgCanvas').getContext('2d');

        async function init() {
            const keys = Object.keys(presets);
            const key = keys[Math.floor(Math.random() * keys.length)];
            currentPreset = presets[key];

            const txtBox = document.getElementById('textContainer');
            txtBox.innerHTML = currentPreset.text.replace(/\n/g, '<br>');

            await Promise.all([
                loadImg(maskImg, `./assets/base-panels/${key}.png`),
                loadImg(blueTex, `./assets/depth/depth-blue.png`),
                loadImg(textTex, `./assets/depth/depth-text.png`),
                loadImg(bgTex, `./assets/depth/depth-yetdarker-new.png`)
            ]);

            txtBox.style.backgroundImage = `url('${textTex.src}')`;
            requestAnimationFrame(loop);

            setTimeout(() => {
                document.getElementById('prophecy-splash').classList.add('fade-out');
                isActive = false;
            }, 5000);
        }

        function loadImg(img, src) {
            return new Promise(resolve => { img.onload = resolve; img.onerror = resolve; img.src = src; });
        }

        function createMaskedCanvas(texture, mask, offset) {
            const canvasSize = 256;
            const temp = document.createElement('canvas');
            temp.width = 512; temp.height = 256;
            const tctx = temp.getContext('2d');

            // 1. Gambar tekstur biru
            const s = offset % canvasSize;
            for(let x = -s; x < 512; x += canvasSize) {
                for(let y = 0; y < 256; y += canvasSize) {
                    tctx.drawImage(texture, x, y, canvasSize, canvasSize);
                }
            }
            const texData = tctx.getImageData(0, 0, 512, 256);

            // 2. Gambar mask ke canvas pembantu
            const mTemp = document.createElement('canvas');
            mTemp.width = 512; mTemp.height = 256;
            const mt = mTemp.getContext('2d');
            const dx = (512 - canvasSize) / 2;
            const dy = (256 - canvasSize) / 2 - (currentPreset.y || 0);
            mt.drawImage(mask, dx, dy, canvasSize, canvasSize);
            const maskData = mt.getImageData(0, 0, 512, 256);

            // 3. Gabungkan pixel
            const res = tctx.createImageData(512, 256);
            for (let i = 0; i < maskData.data.length; i += 4) {
                const brightness = (maskData.data[i] + maskData.data[i+1] + maskData.data[i+2]) / 3;
                if (brightness > 30) { // Threshold lebih rendah agar lebih sensitif
                    res.data[i] = texData.data[i];
                    res.data[i+1] = texData.data[i+1];
                    res.data[i+2] = texData.data[i+2];
                    res.data[i+3] = 255;
                } else {
                    res.data[i+3] = 0;
                }
            }
            tctx.putImageData(res, 0, 0);
            return temp;
        }

        function loop() {
            if(!isActive) return;
            scrollPos += 1;
            const t = performance.now() / 1000;
            const sine = Math.sin(t * 1.5) * 8;
            const gOff = Math.sin(t * 2.5) * 3;

            document.getElementById('sineWrapper').style.transform = `translateY(${sine}px)`;

            const frame = createMaskedCanvas(blueTex, maskImg, scrollPos);
            
            mctx.clearRect(0,0,512,256); mctx.drawImage(frame, 0, 0);
            g1ctx.clearRect(0,0,512,256); g1ctx.drawImage(frame, gOff, gOff);
            g2ctx.clearRect(0,0,512,256); g2ctx.drawImage(frame, gOff*2, gOff*2);

            bgctx.clearRect(0,0,512,256);
            const bgs = (scrollPos * 0.5) % 256;
            for(let x = -bgs; x < 512; x += 256) bgctx.drawImage(bgTex, x, 0, 256, 256);

            requestAnimationFrame(loop);
        }
        window.onload = init;
    </script>
</body>
</html>